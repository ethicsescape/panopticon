# Panopticon Escape Room

Panopticon is a virtual escape room about the ethics of surveillance technology.

Play online for free at [bit.ly/panopticongame](https://bit.ly/panopticongame).

Split up into teams of 2-4 players and create a leaderboard if you have multiple teams.

- [Set Up Project](#set-up-project)
- [Run Locally](#run-locally)
- [Other Common Commands](#other-common-commands)
- [Contributors](#contributors)
- [License](#license)

## Set Up Project

- Install Node dependencies. Please use Node version 12 or higher.

```bash
npm install
```

- Create a `.env` file in the project root directory and ask Vinesh for the credentials.
- Ask Vinesh for the `manage.js` script, which is also not included in the repository.

## Run Locally

You will need two terminal windows, one for the backend and one for the frontend.

**Terminal 1: Backend**

```bash
heroku local web
```

**Terminal 2: Frontend**

```bash
jekyll serve
```

Follow the displayed link, usually [localhost:4000](http://localhost:4000).

To test the game, whether locally or in production, use the unlimited game code **`venn`**. That way, your game will be excluded from analysis.

## Development Overview

### Development Tools

This project uses:

- [Jekyll](https://jekyllrb.com) for frontend static site generation.
- Vanilla HTML, CSS, JS for frontend development.
- Markdown for content development.
- GitHub Pages for frontend deployment.
- [Firebase Realtime Database](https://firebase.google.com/docs/database) for data storage.
- [Express](https://expressjs.com) for the backend API framework.
- Heroku for backend deployment.

### Directory Structure

The main folders and files necessary for developing and running the game are:

```
├── _case/              Markdown/HTML documents for main interactive pages in the game case management system.
├── _data/              Website data files used to generate game content.
|   ├── hints.json      Encoded hints generated by build script and clues config.
|   ├── replays.json    Replay metadata for the movement layer clue.
|   └── scenes.json     Scenes for the training data puzzle.
├── _document/          Markdown/HTML documents for content pages in the game case management system.
├── _layouts/           HTML/Jekyll templates for reusable page layouts.
|   ├── case.html       Template for pages in the game case management system.
|   └── secure.html     Template for locked pages. When unlocked, redirects to a clue page.
├── _secure/            Encoded clue pages generated by build script and clues config.
├── _site/              Website generated by Jekyll.
├── assets/             Assets for the website.
|   ├── css/            Stylesheets for the website.
|   ├── img/            Images for the website.
|   └── js/             JavaScript files for the website.
|       └── script.js   Script used for essentially all game functionality.
├── _config.yml         Config that specifies how to build the website using Jekyll.
├── build.js            Script to generate pages for clues and hints from clues config.
├── clues.json          Config that specifies the clues, passwords, links, and hints.
├── package.json        Node dependencies for the project.
├── server.js           Backend Express server for the game.
└── *.html              Various top-level website pages, explained below.
```

The top-level HTML pages are:

```
├── admin.html          (No longer used) Create access codes and parties, requires admin password.
├── codes.html          Self-service page for visitors to create access codes and parties.
├── discussion.html     Presents players with the post-game reveal, voting, discussion, and results.
├── index.html          Invite links take players here so they can enter the game lobby.
├── intro.html          Lets players view the introduction video, choose screen names, and start the game.
├── party.html          Displays the party leaderboard and team results.
├── privacy.html        Contains the privacy policy.
├── teams.html          Landing page for groups interested in playing the game.
└── terms.html          Contains the terms and conditions.
```

## Other Common Commands

### Rebuild Clues and Hints

After editing `clues.json`, run this command:

```bash
node build.js
```

### Download Game Records

```bash
node manage.js download_games
```

### Compute Game Metrics

```bash
node manage.js compute_metrics
```

### Get Game Data as CSV/SQL

See [sql/data.md](sql/data.md) for instructions.

## Contributors

This virtual escape room was designed by Maria Gargiulo and Vinesh Kannan. Thank you to our friends from Coding It Forward for inspiration, playtesting, and feedback. We dedicate the game to our late friend Courtney Brousseau and to all the people working towards technological justice.

If you have any questions, contact Vinesh Kannan (vingkan [at] gmail [dot] com).

## License

This repository is released under the MIT License.
